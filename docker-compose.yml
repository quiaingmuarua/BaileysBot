x-wabot-base: &wabot-base
  build:
    context: .
    dockerfile: Dockerfile
  # 不要设置 container_name，支持多实例
  network_mode: host
  volumes:
    - ./AUTH:/app/AUTH:rw,Z
    - ./baileys:/app/baileys:ro,Z
    - ./logs:/app/logs:rw,Z
  environment: &wabot-env
    NODE_ENV: production
    WS_URL: 'ws://10.148.0.3:8088/ws'
  healthcheck:
    test: ["CMD", "pgrep", "-f", "node index.js"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s
  deploy:
    resources:
      limits:
        cpus: '1.0'
        memory: 1G
      reservations:
        cpus: '0.25'
        memory: 256M
  restart: unless-stopped

services:
  wabot1:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 1

  wabot2:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 2

  wabot3:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 3

  wabot4:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 4

  wabot5:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 5

  wabot6:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 6

  wabot7:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 7

  wabot8:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 8

  wabot9:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 9

  wabot10:
    <<: *wabot-base
    user: root
    environment:
      <<: *wabot-env
      DEVICE_ID: 10
